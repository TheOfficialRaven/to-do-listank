<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† Intelligens K√ºldet√©sek Teszt</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1F2937;
            color: #F8FAFC;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-container {
            background: #2B3849;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #10B981;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #374151;
            border-radius: 8px;
        }
        
        .test-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
        }
        
        .result {
            background: #1F2937;
            border: 1px solid #4B5563;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .success {
            border-color: #10B981;
            color: #10B981;
        }
        
        .error {
            border-color: #EF4444;
            color: #EF4444;
        }
        
        .info {
            border-color: #3B82F6;
            color: #3B82F6;
        }
        
        h1, h2, h3 {
            color: #10B981;
        }
        
        .mission-card {
            background: #2B3849;
            border: 1px solid #4B5563;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .mission-title {
            font-weight: bold;
            color: #10B981;
            margin-bottom: 5px;
        }
        
        .mission-description {
            color: #D1D5DB;
            margin-bottom: 10px;
        }
        
        .mission-meta {
            font-size: 12px;
            color: #9CA3AF;
        }
    </style>
</head>
<body>
    <h1>üß† Intelligens K√ºldet√©sek Rendszer Teszt</h1>
    
    <div class="test-container">
        <h2>üìã Teszt Funkci√≥k</h2>
        
        <div class="test-section">
            <h3>üîß Rendszer Inicializ√°l√°s</h3>
            <button class="test-btn" onclick="testInitialization()">Rendszer Inicializ√°l√°sa</button>
            <button class="test-btn" onclick="checkSystemStatus()">Rendszer √Ållapot Ellen≈ërz√©se</button>
            <div id="init-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>üéØ K√ºldet√©s Gener√°l√°s</h3>
            <button class="test-btn" onclick="testMissionGeneration()">K√ºldet√©sek Gener√°l√°sa</button>
            <button class="test-btn" onclick="testSubjectExtraction()">Tant√°rgyak Kinyer√©se</button>
            <button class="test-btn" onclick="testEventExtraction()">Esem√©nyek Kinyer√©se</button>
            <div id="generation-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>ü§ñ AI K√ºldet√©s Gener√°l√°s</h3>
            <button class="test-btn" onclick="testAIPromptPreparation()">AI Prompt El≈ëk√©sz√≠t√©se</button>
            <button class="test-btn" onclick="testAIMissionGeneration()">AI K√ºldet√©sek Gener√°l√°sa</button>
            <button class="test-btn" onclick="testSampleAIResponse()">Minta AI V√°lasz</button>
            <div id="ai-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>üìä K√ºldet√©s Sablonok</h3>
            <button class="test-btn" onclick="testTemplates()">Sablonok Tesztel√©se</button>
            <button class="test-btn" onclick="testTemplateSelection()">Sablon V√°laszt√°s</button>
            <div id="templates-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>üéÆ UI Tesztel√©s</h3>
            <button class="test-btn" onclick="testUI()">UI Friss√≠t√©s</button>
            <button class="test-btn" onclick="testMissionCompletion()">K√ºldet√©s Teljes√≠t√©s</button>
            <div id="ui-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>üß™ Teljes Rendszer Teszt</h3>
            <button class="test-btn" onclick="runFullTest()">Teljes Teszt Futtat√°sa</button>
            <button class="test-btn" onclick="clearResults()">Eredm√©nyek T√∂rl√©se</button>
            <div id="full-test-result" class="result"></div>
        </div>
    </div>
    
    <div class="test-container">
        <h2>üìà Gener√°lt K√ºldet√©sek</h2>
        <div id="missions-display"></div>
    </div>
    
    <script>
        // Test functions
        function logResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            
            element.innerHTML += `[${timestamp}] ${message}\n`;
            element.className = `result ${className}`;
            element.scrollTop = element.scrollHeight;
        }
        
        async function testInitialization() {
            logResult('init-result', 'üß† Intelligens k√ºldet√©sek rendszer inicializ√°l√°sa...');
            
            try {
                if (typeof window.testSmartMissions === 'function') {
                    await window.testSmartMissions();
                    logResult('init-result', '‚úÖ Rendszer sikeresen inicializ√°lva!', 'success');
                } else {
                    logResult('init-result', '‚ùå testSmartMissions f√ºggv√©ny nem tal√°lhat√≥', 'error');
                }
            } catch (error) {
                logResult('init-result', `‚ùå Hiba: ${error.message}`, 'error');
            }
        }
        
        async function checkSystemStatus() {
            logResult('init-result', 'üîç Rendszer √°llapot ellen≈ërz√©se...');
            
            const status = {
                smartMissionsManager: !!window.smartMissionsManager,
                dailyQuestsManager: !!window.dailyQuestsManager,
                firebase: !!(window.db && window.auth),
                currentUser: !!window.auth?.currentUser
            };
            
            logResult('init-result', `üìä √Ållapot:\n${JSON.stringify(status, null, 2)}`, 'info');
        }
        
        async function testMissionGeneration() {
            logResult('generation-result', 'üéØ K√ºldet√©sek gener√°l√°sa...');
            
            try {
                if (window.smartMissionsManager) {
                    const missions = await window.smartMissionsManager.generateSmartMissionsForStudent();
                    logResult('generation-result', `‚úÖ ${missions.length} k√ºldet√©s gener√°lva!`, 'success');
                    
                    // Display missions
                    const display = document.getElementById('missions-display');
                    display.innerHTML = '<h3>Gener√°lt K√ºldet√©sek:</h3>';
                    
                    missions.forEach((mission, index) => {
                        const missionCard = document.createElement('div');
                        missionCard.className = 'mission-card';
                        missionCard.innerHTML = `
                            <div class="mission-title">${mission.title}</div>
                            <div class="mission-description">${mission.description}</div>
                            <div class="mission-meta">
                                XP: ${mission.xp} | Id≈ë: ${mission.estimatedDuration} | 
                                Tant√°rgy: ${mission.subject} | T√≠pus: ${mission.missionType}
                            </div>
                        `;
                        display.appendChild(missionCard);
                    });
                } else {
                    logResult('generation-result', '‚ùå Smart missions manager nem inicializ√°lva', 'error');
                }
            } catch (error) {
                logResult('generation-result', `‚ùå Hiba: ${error.message}`, 'error');
            }
        }
        
        async function testSubjectExtraction() {
            logResult('generation-result', 'üìö Tant√°rgyak kinyer√©se...');
            
            try {
                if (window.smartMissionsManager) {
                    const subjects = await window.smartMissionsManager.getStudentSubjects();
                    logResult('generation-result', `‚úÖ ${subjects.length} tant√°rgy tal√°lva: ${subjects.join(', ')}`, 'success');
                } else {
                    logResult('generation-result', '‚ùå Smart missions manager nem inicializ√°lva', 'error');
                }
            } catch (error) {
                logResult('generation-result', `‚ùå Hiba: ${error.message}`, 'error');
            }
        }
        
        async function testEventExtraction() {
            logResult('generation-result', 'üìÖ Esem√©nyek kinyer√©se...');
            
            try {
                if (window.smartMissionsManager) {
                    const events = await window.smartMissionsManager.getStudentEvents();
                    logResult('generation-result', `‚úÖ ${events.length} esem√©ny tal√°lva`, 'success');
                    
                    if (events.length > 0) {
                        events.forEach((event, index) => {
                            logResult('generation-result', `  ${index + 1}. ${event.title || 'N√©vtelen'} - ${event.date || 'D√°tum n√©lk√ºl'}`, 'info');
                        });
                    }
                } else {
                    logResult('generation-result', '‚ùå Smart missions manager nem inicializ√°lva', 'error');
                }
            } catch (error) {
                logResult('generation-result', `‚ùå Hiba: ${error.message}`, 'error');
            }
        }
        
        function testTemplates() {
            logResult('templates-result', 'üìã Sablonok tesztel√©se...');
            
            try {
                if (window.smartMissionsManager) {
                    const templates = window.smartMissionsManager.getStudentMissionTemplates();
                    const templateCount = Object.values(templates).reduce((sum, arr) => sum + arr.length, 0);
                    
                    logResult('templates-result', `‚úÖ ${templateCount} sablon tal√°lva:`, 'success');
                    
                    Object.entries(templates).forEach(([type, templateArray]) => {
                        logResult('templates-result', `  ${type}: ${templateArray.length} sablon`, 'info');
                    });
                } else {
                    logResult('templates-result', '‚ùå Smart missions manager nem inicializ√°lva', 'error');
                }
            } catch (error) {
                logResult('templates-result', `‚ùå Hiba: ${error.message}`, 'error');
            }
        }
        
        function testTemplateSelection() {
            logResult('templates-result', 'üé≤ Sablon v√°laszt√°s tesztel√©se...');
            
            try {
                if (window.smartMissionsManager) {
                    const templates = window.smartMissionsManager.getStudentMissionTemplates();
                    const allTemplates = [
                        ...templates.study_preparation,
                        ...templates.exam_preparation,
                        ...templates.homework_focus,
                        ...templates.review_and_practice
                    ];
                    
                    // Test random selection
                    for (let i = 0; i < 5; i++) {
                        const randomTemplate = window.smartMissionsManager.getRandomFromArray(allTemplates);
                        logResult('templates-result', `  ${i + 1}. ${randomTemplate}`, 'info');
                    }
                    
                    logResult('templates-result', '‚úÖ Sablon v√°laszt√°s tesztel√©se sikeres', 'success');
                } else {
                    logResult('templates-result', '‚ùå Smart missions manager nem inicializ√°lva', 'error');
                }
            } catch (error) {
                logResult('templates-result', `‚ùå Hiba: ${error.message}`, 'error');
            }
        }
        
        async function testUI() {
            logResult('ui-result', 'üé® UI friss√≠t√©s tesztel√©se...');
            
            try {
                if (window.smartMissionsManager) {
                    window.smartMissionsManager.updateSmartMissionsUI();
                    logResult('ui-result', '‚úÖ UI friss√≠t√©s megh√≠vva', 'success');
                } else {
                    logResult('ui-result', '‚ùå Smart missions manager nem inicializ√°lva', 'error');
                }
            } catch (error) {
                logResult('ui-result', `‚ùå Hiba: ${error.message}`, 'error');
            }
        }
        
        async function testMissionCompletion() {
            logResult('ui-result', '‚úÖ K√ºldet√©s teljes√≠t√©s tesztel√©se...');
            
            try {
                if (window.smartMissionsManager) {
                    // Generate a test mission first
                    const missions = await window.smartMissionsManager.generateSmartMissionsForStudent();
                    if (missions.length > 0) {
                        const testMission = missions[0];
                        logResult('ui-result', `üß™ Teszt k√ºldet√©s: ${testMission.title}`, 'info');
                        
                        // Test completion
                        await window.smartMissionsManager.completeSmartMission(testMission.id);
                        logResult('ui-result', '‚úÖ K√ºldet√©s teljes√≠t√©s tesztel√©se sikeres', 'success');
                    } else {
                        logResult('ui-result', '‚ö†Ô∏è Nincs k√ºldet√©s a tesztel√©shez', 'info');
                    }
                } else {
                    logResult('ui-result', '‚ùå Smart missions manager nem inicializ√°lva', 'error');
                }
            } catch (error) {
                logResult('ui-result', `‚ùå Hiba: ${error.message}`, 'error');
            }
        }
        
        async function runFullTest() {
            logResult('full-test-result', 'üöÄ Teljes rendszer teszt ind√≠t√°sa...');
            
            try {
                // 1. Initialization
                logResult('full-test-result', '1Ô∏è‚É£ Rendszer inicializ√°l√°sa...');
                await testInitialization();
                
                // 2. Status check
                logResult('full-test-result', '2Ô∏è‚É£ √Ållapot ellen≈ërz√©se...');
                await checkSystemStatus();
                
                // 3. Mission generation
                logResult('full-test-result', '3Ô∏è‚É£ K√ºldet√©sek gener√°l√°sa...');
                await testMissionGeneration();
                
                // 4. AI prompt preparation
                logResult('full-test-result', '4Ô∏è‚É£ AI prompt el≈ëk√©sz√≠t√©se...');
                await testAIPromptPreparation();
                
                // 5. AI mission generation
                logResult('full-test-result', '5Ô∏è‚É£ AI k√ºldet√©sek gener√°l√°sa...');
                await testAIMissionGeneration();
                
                // 6. Templates test
                logResult('full-test-result', '6Ô∏è‚É£ Sablonok tesztel√©se...');
                testTemplates();
                
                // 7. UI test
                logResult('full-test-result', '7Ô∏è‚É£ UI tesztel√©se...');
                await testUI();
                
                logResult('full-test-result', 'üéâ Teljes teszt sikeresen befejezve!', 'success');
                
            } catch (error) {
                logResult('full-test-result', `‚ùå Teszt hib√°val v√©gz≈ëd√∂tt: ${error.message}`, 'error');
            }
        }
        
        function clearResults() {
            const resultElements = document.querySelectorAll('.result');
            resultElements.forEach(element => {
                element.innerHTML = '';
                element.className = 'result';
            });
            
            document.getElementById('missions-display').innerHTML = '';
        }
        
        async function testAIPromptPreparation() {
            logResult('ai-result', 'ü§ñ AI prompt el≈ëk√©sz√≠t√©se...');
            
            try {
                if (window.smartMissionsManager) {
                    const prompt = await window.smartMissionsManager.prepareMissionPromptForAI();
                    logResult('ai-result', '‚úÖ AI prompt sikeresen el≈ëk√©sz√≠tve!', 'success');
                    logResult('ai-result', `üìù Prompt:\n${prompt}`, 'info');
                } else {
                    logResult('ai-result', '‚ùå Smart missions manager nem inicializ√°lva', 'error');
                }
            } catch (error) {
                logResult('ai-result', `‚ùå Hiba: ${error.message}`, 'error');
            }
        }
        
        async function testAIMissionGeneration() {
            logResult('ai-result', 'ü§ñ AI k√ºldet√©sek gener√°l√°sa...');
            
            try {
                if (window.smartMissionsManager) {
                    const missions = await window.smartMissionsManager.generateMissionsWithAI();
                    logResult('ai-result', `‚úÖ ${missions.length} AI k√ºldet√©s gener√°lva!`, 'success');
                    
                    // Display AI missions
                    const display = document.getElementById('missions-display');
                    display.innerHTML = '<h3>AI Gener√°lt K√ºldet√©sek:</h3>';
                    
                    missions.forEach((mission, index) => {
                        const missionCard = document.createElement('div');
                        missionCard.className = 'mission-card';
                        missionCard.innerHTML = `
                            <div class="mission-title">${mission.title}</div>
                            <div class="mission-description">${mission.description}</div>
                            <div class="mission-meta">
                                XP: ${mission.xp} | Id≈ë: ${mission.estimatedDuration} | 
                                Tant√°rgy: ${mission.subject} | T√≠pus: ${mission.missionType} | AI: ${mission.isAIGenerated ? 'Igen' : 'Nem'}
                            </div>
                        `;
                        display.appendChild(missionCard);
                    });
                } else {
                    logResult('ai-result', '‚ùå Smart missions manager nem inicializ√°lva', 'error');
                }
            } catch (error) {
                logResult('ai-result', `‚ùå Hiba: ${error.message}`, 'error');
            }
        }
        
        async function testSampleAIResponse() {
            logResult('ai-result', 'ü§ñ Minta AI v√°lasz tesztel√©se...');
            
            try {
                if (window.smartMissionsManager) {
                    const samplePrompt = `
K√©rlek, k√©sz√≠ts 3 r√∂vid, motiv√°l√≥, napi k√ºldet√©st egy di√°k sz√°m√°ra a mai feladataihoz.

üìö A mai √≥r√°i: ["matematika", "t√∂rt√©nelem", "fizika"].
üìÖ K√∂zelg≈ë esem√©nyek: ["holnap: matek dolgozat", "p√©nteken: angol prezent√°ci√≥"].
üîÑ A tegnapi k√ºldet√©sei: ["Ism√©teld √°t a matekot!", "√çrj egy v√°zlatot a prezent√°ci√≥hoz"].
                    `;
                    
                    const sampleResponse = window.smartMissionsManager.getSampleMissionResponse(samplePrompt);
                    logResult('ai-result', '‚úÖ Minta AI v√°lasz gener√°lva!', 'success');
                    
                    sampleResponse.forEach((mission, index) => {
                        logResult('ai-result', `  ${index + 1}. ${mission}`, 'info');
                    });
                } else {
                    logResult('ai-result', '‚ùå Smart missions manager nem inicializ√°lva', 'error');
                }
            } catch (error) {
                logResult('ai-result', `‚ùå Hiba: ${error.message}`, 'error');
            }
        }
        
        // Auto-initialize when page loads
        window.addEventListener('load', () => {
            logResult('init-result', 'üåê Oldal bet√∂ltve, tesztel√©si k√∂rnyezet k√©sz', 'info');
        });
    </script>
</body>
</html> 